using System;
using System.IO;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using LaceupMigration.Services;

namespace LaceupMigration.ViewModels
{
	public partial class TermsAndConditionsPageViewModel : ObservableObject
	{
		private readonly ILaceupAppService _appService;

		[ObservableProperty]
		private string _termsContent = string.Empty;

		public bool CanNavigateBack => Config.AcceptedTermsAndConditions;

		public TermsAndConditionsPageViewModel(ILaceupAppService appService)
		{
			_appService = appService;
			
			TermsContent = "\n\t\tThese Terms and Conditions (\\\"Terms\\\") comprise the terms and conditions under which LaceUp Solutions will supply licenses and or Services. You accept these terms on behalf of the entity you represent (\\\"Company\\\") (together with its Affiliates) by either: (i) physically or electronically signing the Terms; or (ii) placing an order with LaceUp Solutions on behalf of Company. Upon acceptance, the Terms will remain in effect until terminated by either party. Either party may terminate the Terms at any time and for any reason by providing prior written notice to the other party. Sections 1, 3, 4, 5, 6, 7, 8, 10, 11, 12, 14, 15, 16 and 17 will survive any termination of the Terms.\n\t\t\\n\\n\\t1. DEFINITIONS AND INTEGRATION\n\t\t\\nIn addition to any definitions contained within the body of these Terms, the following definitions apply:\n\t\t\\n\\n\\\"Affiliates\\\" means any person, corporation or other entity that now or in the future, directly or indirectly controls, is controlled by or is under common control with Company. For purposes of this definition, \\\"control\\\" means with respect to: (a) with respect to a corporation, the ownership, directly or indirectly, of fifty percent (50%) or more of the voting power to elect directors thereof; and (b) with respect to any other entity, the power to direct the management of such entity.\n\t\t\\n\\n\\\"Contract\\\" means an agreement, an Order Confirmation or Invoice, a statement of work or similar document for the supply of licenses or the provision of Services between LaceUp Solutions and Company.\n\t\t\\n\\n\\\"Licensor\\\" means the legal entity that is the owner of the intellectual property rights vested in the software with the authority to define the End User License Agreement (\\\"EULA\\\"), Product Terms (\\\"PT\\\") or other terms and conditions for the use of the software and licenses.\n\t\t\\n\\n\\\"Order Confirmation\\\" means LaceUp Solutions\\' acceptance of Company\\'s purchase order in writing. Company\\'s orders do not represent a binding Order Confirmation.\n\t\t\\n\\n\\\"Services\\\" means any delivery, installation, configuration, consultation or other professional services as specified by the parties in a Contract.\n\t\t\\n\\n\\\"LaceUp Solutions\\\" means the LaceUp Solutions entity named in an Order Confirmation or a Contract.\n\t\t\\n\\nUnless otherwise agreed in writing by LaceUp Solutions, all licenses and Services are supplied under these Terms to the exclusion of any other terms and conditions set out or referred to in any document or other communication used by Company prior to or in concluding a Contract. These Terms will apply to each Contract. In the event of a conflict between the Terms and a Contract, the Terms will control unless all of the following apply: (i) the Contract clearly identifies the applicable section of the Terms that is to be modified; and (ii) the Contract clearly states that such provision of the Contract supersedes the conflicting or inconsistent provision in the Terms. Any other attempt to alter or amend these Terms will be deemed void and have no effect. Any modifications to these Terms contained within a Contract are effective as to that Contract only and will not modify the Terms for any other purpose whatsoever. These Terms cannot be modified except in a written document signed by all parties.\n\t\t\\n\\n\\t2. ORDER AND DELIVERY POLICY\n\t\t\\nPrice quotations and purchase orders are not binding upon either party until an Order Confirmation is delivered. The Order Confirmation is subject to availability by Licensor. Company will receive the licenses by electronic transmission, electronic access or download. Company is responsible for the payment of each order it places and all orders by its Affiliates.\n\t\t\\n\\n\\t3. REFUND POLICY\n\t\t\\nLaceUp Solutions will not accept the refund of supplied licenses unless a mutual agreement is met between LaceUp Solutions and Company or its Affiliates.\n\t\t\\n\\n\\t4. SERVICES\n\t\t\\n\\t\\t4.1 LaceUp Solutions shall perform the Services with due care and in accordance with the Contracts.\n\t\t\\n\\t\\t4.2 LaceUp Solutions will not be required to follow any requests or instructions (\\\"Company Request\\\"), which change or supplement the substance or scope of the Services described in a Contract. If LaceUp Solutions provides the Services described in a Company Request, then Company shall pay for such Services pursuant to these Terms and the applicable Contract.\n\t\t\\n\\t\\t4.3 In the absence of an expressly agreed invoicing schedule, Company shall pay all amounts relating to Services provided by LaceUp Solutions at the beginning of every calendar month in arrears.\n\t\t\\n\\n\\t5. PRICING\n\t\t\\n\\t\\t5.1 LaceUp Solutions will provide the price of the licenses and the Services. All prices are subject to applicable sales or value added taxes. All prices and availability are subject to change unless agreed upon through a binding Order Confirmation, Invoice or a Contract signed by both parties.\n\t\t\\n\\t\\t5.2 If Services, including subscription Services, for Company are performed by a party other than LaceUp Solutions, the fee for such a Service will be determined by the entity performing the Service. Such fees are not always fixed and may be subject to the usage of the Services by Company. Company shall accept the billing model and will pay the fee in accordance with the deadline specified by the third party. Company is solely responsible to ensure that it understands the billing model offered by the third party.\n\t\t\\n\\n\\t6. TAXES\n\t\t\\nCompany shall timely calculate and pay any withholding taxes, import taxes, levies and duties based on cross-border transactions, including those resulting from transactions where LaceUp Solutions and Company are tax residents of different countries. If Company is required by law to deduct or withhold any taxes from any amount payable on a cross-border transaction, the amount payable will be increased so that after making all required deductions and withholdings, LaceUp Solutions receives an amount equal to the amount it would have received had no such deductions and withholdings been made.\n\t\t\\n\\n\\t7. NO WARRANTIES FOR THIRD PARTY SERVICES\n\t\t\\nAll third party services distributed by LaceUp Solutions are delivered with the service provider\\'s limited warranty. The warranties and support for third party services that are not performed by LaceUp Solutions will be governed by the applicable policies and procedures of the service provider. LaceUp Solutions does not make any express or implied warranties for third party services.\n\t\t\\n\\n\\t8. WARRANTIES FOR LACEUP SOLUTIONS SERVICES\n\t\t\\nAny Warranties for all Services performed by LaceUp Solutions will be stated in the applicable Contract and will applied to the Contract in which they are contained. LaceUp Solutions\\' application and Services are provided \\\"as is,\\\" with all faults, and LaceUp Solutions makes no express or implied representations or warranties, of any kind related to its application or the materials contained within the application.\n\t\t\\n\\n\\t9. ORGANIZATION AND AUTHORITY\n\t\t\\nEach party represents that: (i) they are a valid legal entity in good standing under the laws of the jurisdiction in which they are organized; (ii) they have full power and authority to enter into these Terms and any Contract, which will create a binding agreement between the parties; and (iii) the performance by the parties hereunder will not violate any obligation or duty owed to a third party.\n\t\t\\n\\n\\t10. DISCLAIMER OF WARRANTIES AND DAMAGES; LIMITATION OF LIABILITY\n\t\t\\n\\t\\t10.1 In no event shall LaceUp Solutions, its shareholders, directors, officers, employees or other representatives be liable for general, indirect, consequential, or punitive damages or loss of data related to any product or Services sold.\n\t\t\\n\\t\\t10.2 In no event will LaceUp Solutions be liable for any incidental, consequential, special, punitive or indirect damages or losses of any kind, including damages resulting from delay, loss of profits, lost business opportunity, loss of content, interruption of business or loss of goodwill, which may arise in connection with or pertaining to these Terms or any Contract, even if such party has been notified of the possibility or likelihood of such damages occurring under any theory of law (including tort or other theory).\n\t\t\\n\\t\\t10.3 Company agrees that any Contract or other document relating to the purchase of licenses or Services submitted to LaceUp Solutions that includes any warranty to Company or that includes language that may create a liability for LaceUp Solutions, or conflicts with these Terms, is void and of no effect, unless it complies with the integration requirements stated in Section 1.\n\t\t\\n\\n\\t11. INTELLECTUAL PROPERTY RIGHTS\n\t\t\\n\\t\\t11.1 Nothing in these Terms provides Company any right, title or interest in or to any intellectual property comprised in the licenses or the Services, which will at all times remain the property of LaceUp Solutions or of the Licensors, as applicable.\n\t\t\\n\\t\\t11.2 Company represents and warrants that it is buying the licenses for its own internal use and not for resale.\n\t\t\\n\\n\\t12. SUPPORT AND PAYMENT\n\t\t\\n\\t\\t12.1 If payment terms are not indicated in an Order Confirmation, invoices are automatically due the 1st of the next month following the invoice date.\n\t\t\\n\\t\\t12.2 If Company does not pay the amounts owed in a timely manner, LaceUp Solutions has the right to terminate Services to Company. Company shall then pay late payment fees on the outstanding amount, without any written demand or notice of default being necessary. All past due amounts will bear incur a late payment fee of $30.00 USD.\n\t\t\\n\\t\\t12.3 LaceUp Solutions has the right to refuse service to Company as it sees fit.\n\t\t\\n\\t\\t12.4 Company shall pay all charges incurred by authorized users of its account, by credit card or other similar payment mechanisms in effect. To the extent permitted by applicable law, LaceUp Solutions may require Company to pay transaction charges levied by credit card issuers relating to purchases. Company shall reimburse LaceUp Solutions for all bank fees relating to checks, credit card or bankcard sales drafts returned by the Company\\'s bank or card issuer. Company shall pay all attorney fees, court costs, collection agency fees, or any other costs incurred by LaceUp Solutions in collecting any overdue amount owed.\n\t\t\\n\\n\\t13. FORCE MAJEURE\n\t\t\\nLaceUp Solutions shall not be liable to Company for any loss or damages which may be suffered by Company as a direct or indirect result of the supply of licenses and Services by LaceUp Solutions being prevented, hindered, delayed or rendered uneconomic by reason of circumstances or events beyond LaceUp Solutions\\' reasonable control including but not limited to acts of God, war, riot, strike, lock-out, fire, flood, and storm.\n\t\t\\n\\n\\t14. CONFIDENTIALITY\n\t\t\\nSubject to applicable law or regulation, the parties shall maintain the confidentiality of any Confidential Information and shall not, without the prior written consent of the disclosing party (\\\"Discloser\\\"), disclose such confidential information to any third party (excluding affiliates). \\\"Confidential Information\\\" means any information that is designated as \\\"Confidential\\\" by the Discloser or that the receiving party (\\\"Recipient\\\") should reasonably believe to be confidential given the circumstances. Confidential information excludes any information that: (i) is known by the Recipient prior to disclosure; (ii) becomes publicly available through no fault of the Recipient; (iii) is disclosed to Recipient by a third party with the legal right to make such disclosure; or (iv) is independently developed by Recipient without use or reference to the Discloser\\'s Confidential Information.\n\t\t\\n\\n\\t15. JURISDICTION AND GOVERNING LAW\n\t\t\\nIn case of any controversy or dispute, LaceUp Solutions, Company and/or the Affiliates shall discuss the matter in controversy or dispute and make a diligent effort to find an amicable solution. If the dispute is not resolved by finding an amicable solution, all disputes arising out of or in connection with these Terms or their validity will be finally resolved by the courts of the state/country in which the offices of the LaceUp Solutions Affiliate entering into the Contract are located. The United Nations Convention on the International Sales of Goods will not apply to these Terms or any Contract.\n\t\t\\n\\n\\t16. RESTRICTIONS\n\t\t\\nCompany is expressly and emphatically restricted from all of the following: (i) Publishing any slanderous material regarding LaceUp Solutions application or Services in any media; (ii) Selling, sublicensing and/or otherwise commercializing any of LaceUp Solutions\\' material; (iii) Publicly performing and/or showing of LaceUp Solutions\\' material; (iv) Engaging in any data mining, data harvesting, data extracting or any other similar activity in relation to LaceUp Solutions\\' application, Services or its customers.\n\t\t\\n\\n\\t17. GENERAL\n\t\t\\n\\t\\t17.1 The invalidity or unenforceability of any provision of these Terms will not adversely affect the validity or enforceability of the remaining provisions.\n\t\t\\n\\t\\t17.2 All notices and other communications required or permitted to be served or given shall be in writing.\n\t\t\\n\\t\\t17.3 The failure of LaceUp Solutions to enforce the terms of these Terms does not constitute a waiver of it and will in no way affect the right to later enforce such terms.\n\t\t\\n\\t\\t17.4 Any heading, caption, or paragraph title contained in these Terms is inserted only as a matter of convenience and in no way defines or explains any paragraph or provision hereof.\n\t\t\\n\\t\\t17.5 These Terms may be executed in any number of counterparts, which taken together will represent a single document. Digital, facsimile, and other electronic signatures will be deemed to be originals and will be enforceable between the parties.\n\t\t\\n\\t\\t17.6 These Terms together with the Contracts, represent the entire agreement between the parties regarding the subject matter hereof, and supersede all other agreements and understandings.\n";
			
		}

		[RelayCommand]
		private async Task Accept()
		{
			Config.AcceptedTermsAndConditions = true;
			Config.SaveAppStatus();
			OnPropertyChanged(nameof(CanNavigateBack));

			var isTimeOut = false;
			if (!string.IsNullOrEmpty(Config.LastSignIn) && Config.EnableAdvancedLogin)
			{
				var date = new DateTime(Convert.ToInt64(Config.LastSignIn));
				if (date.AddHours(Config.LoginTimeOut) < DateTime.Now)
					isTimeOut = true;
			}

			if (!Config.EnableSelfServiceModule && Config.SignedIn && !isTimeOut)
			{
				await GoToAsyncOrMainAsync("///MainPage");
			}
			else
			{
				if (Config.EnableLogin)
				{
					await GoToAsyncOrMainAsync("login");
				}
				else
				{
					var target = Config.EnableAdvancedLogin ? "newlogin" : "loginconfig";
					await GoToAsyncOrMainAsync(target);
				}
			}
		}

		private static async Task GoToAsyncOrMainAsync(string route)
		{
			try
			{
				await Shell.Current.GoToAsync(route);
			}
			catch
			{
				await Shell.Current.GoToAsync("///MainPage");
			}
		}
	}
}

