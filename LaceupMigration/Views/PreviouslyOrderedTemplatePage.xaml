<?xml version="1.0" encoding="utf-8" ?>
<local:LaceupContentPage xmlns:local="clr-namespace:LaceupMigration.Views" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LaceupMigration.ViewModels"
             x:Class="LaceupMigration.Views.PreviouslyOrderedTemplatePage"
             x:DataType="vm:PreviouslyOrderedTemplatePageViewModel"
             Shell.NavBarIsVisible="True"
             Shell.TabBarIsVisible="False"
             Title="{Binding OrderTypeText}">
    <ContentPage.Content>
        <Grid RowDefinitions="Auto,Auto,Auto,*">
            <!-- Action Buttons -->
            <Grid x:Name="ActionButtonsGrid" Grid.Row="0" ColumnSpacing="4" Padding="8,8,8,4">
                <Button Text="Add Credit"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding AddCreditCommand}"
                        IsEnabled="{Binding CanEdit}"
                        IsVisible="{Binding ShowAddCredit}"
                        Grid.Column="0" />
                <Button x:Name="ProdButton" Text="Prod"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding ViewProductsCommand}"
                        IsEnabled="{Binding CanEdit}"
                        Grid.Column="1" />
                <Button x:Name="CatsButton" Text="Cats"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding ViewCategoriesCommand}"
                        IsEnabled="{Binding CanEdit}"
                        Grid.Column="2" />
                <Button x:Name="SearchButton" Text="Search"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding SearchCommand}"
                        IsEnabled="{Binding CanEdit}"
                        Grid.Column="3" />
                <Button x:Name="SendButton" Text="Send"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding SendOrderCommand}"
                        IsEnabled="{Binding CanEdit}"
                        IsVisible="{Binding ShowSendButton}"
                        Grid.Column="4" />
            </Grid>

            <!-- Customer and Order Summary -->
            <Frame Grid.Row="1" Padding="12" Margin="8,2" HasShadow="False" CornerRadius="8" BackgroundColor="{StaticResource White}">
                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,*,*" ColumnSpacing="10" RowSpacing="4">
                    <!-- Customer Name -->
                    <Label Grid.Row="0" Grid.ColumnSpan="3"
                           Text="{Binding ClientName}"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource PrimaryDark}"
                           Margin="0,0,0,2" />
                    
                    <!-- Company -->
                    <Label Grid.Row="1" Grid.ColumnSpan="3"
                           Text="{Binding CompanyText}"
                           FontSize="13"
                           TextColor="{StaticResource Gray600}"
                           IsVisible="{Binding ShowCompany}"
                           Margin="0,0,0,2" />
                    
                    <!-- Terms -->
                    <Label Grid.Row="2" Grid.ColumnSpan="3"
                           Text="{Binding TermsText}"
                           FontSize="13"
                           TextColor="{StaticResource Gray600}"
                           Margin="0,0,0,2" />
                    
                    <!-- Order Metrics (Left Column) -->
                    <VerticalStackLayout Grid.Row="3" Grid.Column="0" Spacing="2">
                        <Label Text="{Binding LinesText}"
                               FontSize="13"
                               TextColor="{StaticResource Gray900}" />
                        <Label Text="{Binding QtySoldText}"
                               FontSize="13"
                               TextColor="{StaticResource Gray900}" />
                    </VerticalStackLayout>
                    
                    <!-- Order Financials (Middle Column) -->
                    <VerticalStackLayout Grid.Row="3" Grid.Column="1" Spacing="2">
                        <Label Text="{Binding OrderAmountText}"
                               FontSize="13"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                        <Label Text="{Binding CreditAmountText}"
                               FontSize="13"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                        <Label Text="{Binding SubtotalText}"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                    </VerticalStackLayout>
                    
                    <!-- Order Financials (Right Column) -->
                    <VerticalStackLayout Grid.Row="3" Grid.Column="2" Spacing="2">
                        <Label Text="{Binding TaxText}"
                               FontSize="13"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                        <Label Text="{Binding DiscountText}"
                               FontSize="13"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowDiscount}" />
                        <Label Text="{Binding TotalText}"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryDark}"
                               IsVisible="{Binding ShowTotals}" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Sort By -->
            <Grid Grid.Row="2" Padding="8,2,16,2">
                <Label Text="{Binding SortByText}"
                       FontSize="14"
                       TextColor="{StaticResource PrimaryDark}"
                       HorizontalOptions="End"
                       VerticalOptions="Center">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SortByCommand}" />
                    </Label.GestureRecognizers>
                </Label>
            </Grid>

            <!-- Previously Ordered Products List -->
            <CollectionView Grid.Row="3"
                            ItemsSource="{Binding PreviouslyOrderedProducts}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:PreviouslyOrderedProductViewModel">
                        <Frame Padding="10" Margin="8,2" HasShadow="False" CornerRadius="8" BackgroundColor="{StaticResource White}">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCellTapped" />
                            </Frame.GestureRecognizers>
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="2">
                                <!-- Product Name and OH -->
                                <Label Grid.Column="0" Grid.Row="0"
                                       Text="{Binding ProductName}"
                                       FontSize="15"
                                       FontAttributes="Bold"
                                       TextColor="{Binding ProductNameColor}" />
                                <Label Grid.Column="1" Grid.Row="0"
                                       Text="{Binding OnHandText}"
                                       FontSize="13"
                                       TextColor="{StaticResource PrimaryDark}"
                                       HorizontalOptions="End" />
                                
                                <!-- Product Details (Left) -->
                                <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="1">
                                    <Label Text="{Binding ListPriceText}"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray600}" />
                                    <Label Text="{Binding TypeText}"
                                           FontSize="12"
                                           FontAttributes="Bold"
                                           TextColor="{Binding ProductNameColor}"
                                           IsVisible="{Binding ShowTypeText}" />
                                    <Label Text="{Binding LastVisitText}"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray600}"
                                           IsVisible="{Binding ShowLastVisit}" />
                                    <Label Text="{Binding PerWeekText}"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray600}"
                                           IsVisible="{Binding ShowPerWeek}" />
                                </VerticalStackLayout>
                                
                                <!-- Price and Add Button (Right) -->
                                <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="2" HorizontalOptions="End">
                                    <Label Text="{Binding PriceText}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Gray900}"
                                           HorizontalOptions="End" />
                                    <Label Text="{Binding TotalText}"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray600}"
                                           HorizontalOptions="End" />
                                    <Button Text="{Binding QuantityButtonText}"
                                            Command="{Binding AddProductCommand}"
                                            CommandParameter="{Binding .}"
                                            IsEnabled="{Binding IsEnabled}"
                                            WidthRequest="90"
                                            HeightRequest="36"
                                            BackgroundColor="{StaticResource PrimaryDark}"
                                            TextColor="White"
                                            FontSize="18"
                                            FontAttributes="Bold"
                                            CornerRadius="4"
                                            HorizontalOptions="End"
                                            Margin="0,2,0,0">
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroupList>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualState x:Name="Disabled">
                                                        <VisualState.Setters>
                                                            <Setter Property="BackgroundColor" Value="{StaticResource Gray300}" />
                                                            <Setter Property="TextColor" Value="{StaticResource Gray400}" />
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateGroupList>
                                        </VisualStateManager.VisualStateGroups>
                                    </Button>
                                </VerticalStackLayout>

                                <!-- Suggested Products Label (Green, at bottom) -->
                                <Label Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="2"
                                       Text="{Binding SuggestedLabelText}"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource colorLaceupGreen}"
                                       IsVisible="{Binding IsSuggested}"
                                       Margin="0,4,0,0" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="No previously ordered products found."
                           FontSize="16"
                           TextColor="{StaticResource Gray600}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Margin="0,50,0,0" />
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</local:LaceupContentPage>

