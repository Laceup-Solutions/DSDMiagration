<?xml version="1.0" encoding="utf-8" ?>
<local:LaceupContentPage xmlns:local="clr-namespace:LaceupMigration.Views" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LaceupMigration.ViewModels"
             x:Class="LaceupMigration.Views.PreviouslyOrderedTemplatePage"
             x:DataType="vm:PreviouslyOrderedTemplatePageViewModel"
             Shell.NavBarIsVisible="True"
             Shell.TabBarIsVisible="False"
             Title="{Binding OrderTypeText}">
    <ContentPage.Content>
        <Grid RowDefinitions="Auto,Auto,Auto,*">
            <!-- Action Buttons -->
            <Grid Grid.Row="0" ColumnDefinitions="*,*,*,*,*" ColumnSpacing="4" Padding="8,8,8,4">
                <Button Text="Add Credit"
                        Command="{Binding AddCreditCommand}"
                        IsEnabled="{Binding CanEdit}"
                        IsVisible="{Binding ShowAddCredit}"
                        BackgroundColor="{StaticResource PrimaryDark}"
                        TextColor="White"
                        Grid.Column="0" />
                <Button Text="Prod"
                        Command="{Binding ViewProductsCommand}"
                        IsEnabled="{Binding CanEdit}"
                        BackgroundColor="{StaticResource PrimaryDark}"
                        TextColor="White"
                        Grid.Column="1" />
                <Button Text="Cats"
                        Command="{Binding ViewCategoriesCommand}"
                        IsEnabled="{Binding CanEdit}"
                        BackgroundColor="{StaticResource PrimaryDark}"
                        TextColor="White"
                        Grid.Column="2" />
                <Button Text="Search"
                        Command="{Binding SearchCommand}"
                        IsEnabled="{Binding CanEdit}"
                        BackgroundColor="{StaticResource PrimaryDark}"
                        TextColor="White"
                        Grid.Column="3" />
                <Button Text="Send"
                        Command="{Binding SendOrderCommand}"
                        IsEnabled="{Binding CanEdit}"
                        IsVisible="{Binding ShowSendButton}"
                        BackgroundColor="{StaticResource PrimaryDark}"
                        TextColor="White"
                        Grid.Column="4" />
            </Grid>

            <!-- Customer and Order Summary -->
            <Frame Grid.Row="1" Padding="16" Margin="8,4" HasShadow="False" CornerRadius="8" BackgroundColor="{StaticResource White}">
                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,*,*" ColumnSpacing="12" RowSpacing="8">
                    <!-- Customer Name -->
                    <Label Grid.Row="0" Grid.ColumnSpan="3"
                           Text="{Binding ClientName}"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource PrimaryDark}" />
                    
                    <!-- Company -->
                    <Label Grid.Row="1" Grid.ColumnSpan="3"
                           Text="{Binding CompanyText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray600}"
                           IsVisible="{Binding ShowCompany}" />
                    
                    <!-- Terms -->
                    <Label Grid.Row="2" Grid.ColumnSpan="3"
                           Text="{Binding TermsText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray600}" />
                    
                    <!-- Order Metrics (Left Column) -->
                    <VerticalStackLayout Grid.Row="3" Grid.Column="0" Spacing="4">
                        <Label Text="{Binding LinesText}"
                               FontSize="14"
                               TextColor="{StaticResource Gray900}" />
                        <Label Text="{Binding QtySoldText}"
                               FontSize="14"
                               TextColor="{StaticResource Gray900}" />
                    </VerticalStackLayout>
                    
                    <!-- Order Financials (Middle Column) -->
                    <VerticalStackLayout Grid.Row="3" Grid.Column="1" Spacing="4">
                        <Label Text="{Binding OrderAmountText}"
                               FontSize="14"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                        <Label Text="{Binding CreditAmountText}"
                               FontSize="14"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                        <Label Text="{Binding SubtotalText}"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                    </VerticalStackLayout>
                    
                    <!-- Order Financials (Right Column) -->
                    <VerticalStackLayout Grid.Row="3" Grid.Column="2" Spacing="4">
                        <Label Text="{Binding TaxText}"
                               FontSize="14"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowTotals}" />
                        <Label Text="{Binding DiscountText}"
                               FontSize="14"
                               TextColor="{StaticResource Gray900}"
                               IsVisible="{Binding ShowDiscount}" />
                        <Label Text="{Binding TotalText}"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryDark}"
                               IsVisible="{Binding ShowTotals}" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Sort By -->
            <Grid Grid.Row="2" Padding="8,4,16,4">
                <Label Text="{Binding SortByText}"
                       FontSize="14"
                       TextColor="{StaticResource PrimaryDark}"
                       HorizontalOptions="End"
                       VerticalOptions="Center">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SortByCommand}" />
                    </Label.GestureRecognizers>
                </Label>
            </Grid>

            <!-- Previously Ordered Products List -->
            <CollectionView Grid.Row="3"
                            ItemsSource="{Binding PreviouslyOrderedProducts}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:PreviouslyOrderedProductViewModel">
                        <Frame Padding="12" Margin="8,4" HasShadow="False" CornerRadius="8" BackgroundColor="{StaticResource White}">
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="4">
                                <!-- Product Name and OH -->
                                <Label Grid.Column="0" Grid.Row="0"
                                       Text="{Binding ProductName}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{Binding ProductNameColor}" />
                                <Label Grid.Column="1" Grid.Row="0"
                                       Text="{Binding OnHandText}"
                                       FontSize="14"
                                       TextColor="{StaticResource PrimaryDark}"
                                       HorizontalOptions="End" />
                                
                                <!-- Product Details (Left) -->
                                <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="2">
                                    <Label Text="{Binding ListPriceText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}" />
                                    <Label Text="{Binding TypeText}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{Binding ProductNameColor}"
                                           IsVisible="{Binding ShowTypeText}" />
                                    <Label Text="{Binding LastVisitText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}"
                                           IsVisible="{Binding ShowLastVisit}" />
                                    <Label Text="{Binding PerWeekText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}"
                                           IsVisible="{Binding ShowPerWeek}" />
                                </VerticalStackLayout>
                                
                                <!-- Price and Add Button (Right) -->
                                <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="4" HorizontalOptions="End">
                                    <Label Text="{Binding PriceText}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Gray900}"
                                           HorizontalOptions="End" />
                                    <Label Text="{Binding TotalText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}"
                                           HorizontalOptions="End" />
                                    <Button Text="{Binding QuantityButtonText}"
                                            Command="{Binding AddProductCommand}"
                                            CommandParameter="{Binding .}"
                                            IsEnabled="{Binding IsEnabled}"
                                            WidthRequest="60"
                                            HeightRequest="40"
                                            BackgroundColor="{StaticResource PrimaryDark}"
                                            TextColor="White"
                                            FontSize="20"
                                            FontAttributes="Bold"
                                            CornerRadius="4"
                                            HorizontalOptions="End" />
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="No previously ordered products found."
                           FontSize="16"
                           TextColor="{StaticResource Gray600}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Margin="0,50,0,0" />
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</local:LaceupContentPage>

