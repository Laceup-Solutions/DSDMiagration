<?xml version="1.0" encoding="utf-8" ?>
<local:LaceupContentPage xmlns:local="clr-namespace:LaceupMigration.Views" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LaceupMigration.ViewModels"
             x:Class="LaceupMigration.Views.NewLoadOrderTemplatePage"
             x:DataType="vm:NewLoadOrderTemplatePageViewModel"
             Shell.NavBarIsVisible="True"
             Shell.TabBarIsVisible="False"
             Title="Load Order">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="MENU" Order="Primary" Priority="0" />
    </ContentPage.ToolbarItems>
    <ContentPage.Content>
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,*" Padding="5">
            <!-- Action Buttons Row (Save, Prod, Cats, Search, Set Date) -->
            <Grid Grid.Row="0" ColumnDefinitions="*,*,*,*,*" ColumnSpacing="5">
                <Button Grid.Column="0"
                        Text="Save"
                        Command="{Binding SaveCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontSize="14"
                        Padding="8,12"
                        BorderWidth="0" />
                <Button Grid.Column="1"
                        Text="Prod"
                        Command="{Binding ProdCommand}"
                        IsEnabled="{Binding IsNotReadOnly}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontSize="14"
                        Padding="8,12"
                        BorderWidth="0" />
                <Button Grid.Column="2"
                        Text="Cats"
                        Command="{Binding CatsCommand}"
                        IsEnabled="{Binding IsNotReadOnly}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontSize="14"
                        Padding="8,12"
                        BorderWidth="0" />
                <Button Grid.Column="3"
                        Text="Search"
                        Command="{Binding SearchCommand}"
                        IsEnabled="{Binding IsNotReadOnly}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontSize="14"
                        Padding="8,12"
                        BorderWidth="0" />
                <Button Grid.Column="4"
                        Text="Set Date"
                        Command="{Binding SetDateCommand}"
                        IsEnabled="{Binding IsNotReadOnly}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontSize="14"
                        Padding="8,12"
                        BorderWidth="0" />
            </Grid>

            <!-- Next Service Date Layout (only visible if Config.AutoGenerateLoadOrder) -->
            <Grid Grid.Row="1" 
                  ColumnDefinitions="Auto,*"
                  Padding="10,8"
                  IsVisible="{Binding ShowNextServiceDate}">
                <Label Grid.Column="0"
                       Text="Next Service Date:"
                       FontSize="14"
                       VerticalOptions="Center" />
                <Button Grid.Column="1"
                        x:Name="NextServiceDateButton"
                        Text="{Binding NextServiceDateText}"
                        Command="{Binding NextServiceDateCommand}"
                        HorizontalOptions="Start"
                        BackgroundColor="Transparent"
                        TextColor="Black"
                        FontSize="14"
                        Padding="10,0,0,0" />
            </Grid>

            <!-- Site/Warehouse Selection (only visible if canSelectSite) -->
            <Grid Grid.Row="2"
                  ColumnDefinitions="*,*"
                  Padding="10,8"
                  IsVisible="{Binding ShowSiteSelection}">
                <Label Grid.Column="0"
                       Text="Warehouse:"
                       FontSize="15"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       HorizontalOptions="End" />
                <Picker Grid.Column="1"
                        ItemsSource="{Binding Sites}"
                        SelectedItem="{Binding SelectedSite}"
                        ItemDisplayBinding="{Binding Name}"
                        FontSize="14"
                        Margin="5,0" />
            </Grid>

            <!-- Order Summary (Driver, Ship Date, Term) -->
            <VerticalStackLayout Grid.Row="3" Padding="10,8" Spacing="4">
                <Grid ColumnDefinitions="*,*">
                    <Label Grid.Column="0"
                           Text="{Binding DriverText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}"
                           IsVisible="{Binding ShowDriver}" />
                    <Label Grid.Column="1"
                           Text="{Binding ShipDateText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}" />
                </Grid>
                <Label Text="{Binding TermText}"
                       FontSize="14"
                       TextColor="{StaticResource Gray700}"
                       IsVisible="{Binding ShowTerm}" />
            </VerticalStackLayout>

            <!-- Total Qty -->
            <Grid Grid.Row="4" Padding="10,8">
                <Label Text="{Binding TotalQtyText}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray900}" />
            </Grid>

            <!-- Product List -->
            <CollectionView Grid.Row="5"
                            ItemsSource="{Binding OrderDetails}"
                            SelectionMode="None"
                            Margin="0,10,0,0">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:LoadOrderDetailViewModel">
                        <Grid Style="{StaticResource CollectionViewItemStyle}">
                            <Frame Padding="12" Margin="8,4" HasShadow="False" CornerRadius="8" 
                                   BackgroundColor="{StaticResource Gray50}" BorderColor="{StaticResource Gray200}">
                                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                                <!-- Product Name -->
                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="{Binding ProductName}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource PrimaryDark}"
                                       VerticalOptions="Center" />
                                
                                <!-- Quantity Button -->
                                <Button Grid.Row="0" Grid.Column="1"
                                        Text="{Binding QuantityText}"
                                        Clicked="QtyButton_Clicked"
                                        IsEnabled="{Binding IsEnabled}"
                                        BackgroundColor="{StaticResource Gray300}"
                                        TextColor="Black"
                                        FontSize="14"
                                        WidthRequest="60"
                                        HeightRequest="40"
                                        Padding="0" />
                                
                                <!-- Inventory Info (OH and Truck Inventory) -->
                                <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                      ColumnDefinitions="*,*"
                                      Margin="5,4,0,0"
                                      IsVisible="{Binding ShowInventory}">
                                    <Label Grid.Column="0"
                                           Text="{Binding OnHandText}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource PrimaryDark}" />
                                    <Label Grid.Column="1"
                                           Text="{Binding TruckInventoryText}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource PrimaryDark}" />
                                </Grid>
                                </Grid>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</local:LaceupContentPage>

