<?xml version="1.0" encoding="utf-8" ?>
<local:LaceupContentPage xmlns:local="clr-namespace:LaceupMigration.Views" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LaceupMigration.ViewModels"
             xmlns:icons="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             x:Class="LaceupMigration.Views.SelectGoalPage"
             Shell.TabBarIsVisible="False"
             Title="Goals">
    <Grid RowDefinitions="Auto,Auto,*">
        <!-- Search Bar at the top (matching Xamarin layout) -->
        <SearchBar Grid.Row="0"
                   Text="{Binding SearchText}"
                   Placeholder="Search Goals"
                   Margin="8,8,8,0"
                   TextChanged="OnSearchTextChanged" />
        
        <StackLayout Grid.Row="1" Orientation="Horizontal"  HorizontalOptions="FillAndExpand" >
            <Grid ColumnDefinitions="auto,*,auto" HorizontalOptions="FillAndExpand" Margin="20,5,5,10" >
                <Label Grid.Column="0" Text="Goals" FontSize="18" VerticalOptions="Center" FontAttributes="Bold" TextColor="{StaticResource colorLaceupDark}"></Label>

                <Button Grid.Column="2" BackgroundColor="Transparent" 
                        ImageSource="{icons:MaterialOutlined Icon=Menu, IconColor={StaticResource colorLaceupDark}}" ></Button>  
            </Grid>
        </StackLayout>

        <ActivityIndicator Grid.Row="2"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           Color="{StaticResource Primary}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center" />

        <CollectionView Grid.Row="2"
                        ItemsSource="{Binding FilteredGoals}"
                        Margin="10,20,10,10">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:GoalItemViewModel">
                    <Border Margin="0,20,0,10"
                            Padding="0"
                            BackgroundColor="Transparent"
                            Stroke="{StaticResource colorLaceupDark}"
                            StrokeThickness="2"
                            InputTransparent="True">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectGoalCommand}" 
                                                  CommandParameter="{Binding}" />
                        </Border.GestureRecognizers>
                        <VerticalStackLayout Spacing="0" InputTransparent="True">
                            <!-- Header Section (matching Xamarin cellHeader) -->
                            <Grid ColumnDefinitions="*,*"
                                  BackgroundColor="{StaticResource colorLaceupLightBlue}"
                                  Padding="3,3,2,3"
                                  Margin="3,3,2,0">
                                <Label Grid.Column="0"
                                       Text="{Binding Name, StringFormat='  {0}'}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="1"
                                       Text="{Binding CriteriaText, StringFormat='Type Data {0}'}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="Black"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center"
                                       Margin="0,0,5,0" />
                            </Grid>
                            
                            <!-- Main Content Section -->
                            <Grid ColumnDefinitions="0.4*,0.6*"
                                  Padding="5"
                                  Margin="5">
                                <!-- Left Side: Dates -->
                                <VerticalStackLayout Grid.Column="0"
                                                     Spacing="0"
                                                     Margin="5,0,0,0">
                                    <Label Text="{Binding StartDateText}"
                                           FontSize="12"
                                           TextColor="Black" />
                                    <Label Text="{Binding DaysToCompleteText}"
                                           FontSize="10"
                                           TextColor="Black"
                                           Margin="0,0,0,0" />
                                    <Label Text="{Binding EndDateText}"
                                           FontSize="12"
                                           TextColor="Black" />
                                </VerticalStackLayout>
                                
                                <!-- Right Side: Progress -->
                                <VerticalStackLayout Grid.Column="1"
                                                     Spacing="0"
                                                     Margin="5,0,5,0">
                                    <!-- Percentage Row -->
                                    <Grid ColumnDefinitions="0.7*,0.2*"
                                          Margin="0,0,5,0">
                                        <Label Grid.Column="0"
                                               Text="Real Accomplished"
                                               FontSize="10"
                                               TextColor="Black"
                                               VerticalOptions="Center" />
                                        <Label Grid.Column="1"
                                               Text="{Binding PercentageText}"
                                               FontSize="10"
                                               FontAttributes="Bold"
                                               TextColor="Black"
                                               HorizontalOptions="End"
                                               VerticalOptions="Center" />
                                    </Grid>
                                    
                                    <!-- Progress Bar -->
                                    <ProgressBar Progress="{Binding ProgressValue}"
                                                 ProgressColor="{Binding ProgressColor}"
                                                 Margin="0,0,5,0"
                                                 HeightRequest="8"
                                                 VerticalOptions="Center" />
                                    
                                    <!-- Pending Days -->
                                    <Label Text="{Binding PendingDaysText}"
                                           FontSize="12"
                                           TextColor="{StaticResource colorLaceupRed}"
                                           HorizontalOptions="End"
                                           Margin="0,0,5,0" />
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</local:LaceupContentPage>
