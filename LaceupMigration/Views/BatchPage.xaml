<?xml version="1.0" encoding="utf-8" ?>
<local:LaceupContentPage xmlns:local="clr-namespace:LaceupMigration.Views" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LaceupMigration.ViewModels"
             x:Class="LaceupMigration.Views.BatchPage"
             x:DataType="vm:BatchPageViewModel"
             Shell.NavBarIsVisible="True"
             xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             Shell.TabBarIsVisible="False"
             Title="{Binding ClientName}">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="MENU" Command="{Binding ShowMenuCommand}" Order="Primary" Priority="0" />
    </ContentPage.ToolbarItems>
    <ContentPage.Content>
        <Grid RowDefinitions="Auto,Auto,*">
            <!-- Action Buttons -->
            <Grid Grid.Row="0" ColumnDefinitions="*,*,*,*" ColumnSpacing="4" Padding="8,8,8,4">
                <Button Text="Print"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding PrintCommand}"
                        IsEnabled="{Binding CanPrint}"
                        Grid.Column="0" />
                <Button Text="Finalize"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding FinalizeCommand}"
                        IsEnabled="{Binding CanFinalize}"
                        Grid.Column="1" />
                <Button Text="Void"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding VoidCommand}"
                        IsEnabled="{Binding CanVoid}"
                        Grid.Column="2" />
                <Button Text="Clock Out"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding ClockOutCommand}"
                        IsEnabled="{Binding CanClockOut}"
                        Grid.Column="3" />
            </Grid>

            <!-- Clock In, Clock Out, and Totals -->
            <VerticalStackLayout Grid.Row="1" Padding="16,8" Spacing="4">
                <Label Text="{Binding ClockInText}"
                       FontSize="14"
                       TextColor="{StaticResource Gray700}" />
                <Label Text="{Binding ClockOutText}"
                       FontSize="14"
                       TextColor="{StaticResource Gray700}"
                       IsVisible="{Binding ShowClockOut}" />
                <Label Text="{Binding TotalText}"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray900}"
                       IsVisible="{Binding ShowTotals}" />
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12" IsVisible="{Binding ShowTotals}">
                    <Label Text="{Binding SalesQtyText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}"
                           Grid.Column="0" />
                    <Label Text="{Binding ReturnQtyText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}"
                           Grid.Column="1" />
                    <Label Text="{Binding DumpQtyText}"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}"
                           Grid.Column="2" />
                </Grid>
            </VerticalStackLayout>

            <!-- Orders List -->
            <CollectionView Grid.Row="2"
                            x:Name="OrdersCollectionView"
                            ItemsSource="{Binding Orders}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:BatchOrderViewModel">
                        <Frame Padding="12" Margin="8,4" HasShadow="False" CornerRadius="8" BackgroundColor="{StaticResource White}">
                            <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="12">
                                <CheckBox Grid.Column="0" Grid.RowSpan="3"
                                          IsChecked="{Binding IsSelected}"
                                          VerticalOptions="Center"
                                          IsEnabled="{Binding CanSelect}" />
                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <VerticalStackLayout.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ViewOrderCommand}" />
                                    </VerticalStackLayout.GestureRecognizers>
                                    <Label Text="{Binding ClientName}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource PrimaryDark}" />
                                    <Label Text="{Binding TotalText}"
                                           FontSize="14"
                                           TextColor="{StaticResource Gray900}"
                                           IsVisible="{Binding ShowTotal}" />
                                    <!-- Status Label (Finalized/Voided/Reshipped/Ready To Finalize) -->
                                    <Label Text="{Binding StatusText}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{Binding StatusColor}"
                                           IsVisible="{Binding ShowStatus}"
                                           Margin="0,2,0,0" />
                                    <!-- Company: {name} on top when order has CompanyId > 0 -->
                                    <Label Text="{Binding CompanyText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}"
                                           IsVisible="{Binding ShowCompany}" />
                                    <!-- No Service: reason (e.g. "Will Order Next Time") -->
                                    <Label Text="{Binding ReasonText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}"
                                           IsVisible="{Binding ShowReason}" />
                                    <Label Text="{Binding TermText}"
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}" />
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</local:LaceupContentPage>
